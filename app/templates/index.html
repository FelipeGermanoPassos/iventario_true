<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio de Equipamentos TI</title>
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#EF7D2D">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Invent√°rio de Equipamentos TI</h1>
            <div class="header-buttons">
                <div class="user-info">
                    <a href="{{ url_for('main.perfil') }}" class="user-name" title="Ver meu perfil">üë§ {{ current_user.nome }}</a>
                    <a href="{{ url_for('main.relatorios') }}" class="btn btn-relatorios" title="Relat√≥rios de Empr√©stimos">üìä Relat√≥rios</a>
                    {% if current_user.is_admin %}
                    <a href="{{ url_for('main.admin') }}" class="btn btn-admin" title="Painel Administrativo">‚öôÔ∏è Admin</a>
                    {% endif %}
                    <a href="{{ url_for('main.logout') }}" class="btn btn-logout">üö™ Sair</a>
                </div>
                <button id="btnNovoEquipamento" class="btn btn-primary">+ Novo Equipamento</button>
                <button id="btnNovoEmprestimo" class="btn btn-success">üì¶ Novo Empr√©stimo</button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="mostrarTab('estoque')">üì¶ Estoque</button>
            <button class="tab-button" onclick="mostrarTab('emprestimos')">üìã Empr√©stimos</button>
        </div>

        <!-- Tab Estoque -->
        <div id="tabEstoque" class="tab-content active">
        <!-- Dashboard -->
        <section class="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üíª</div>
                    <div class="stat-content">
                        <h3 id="totalEquipamentos">0</h3>
                        <p>Total de Equipamentos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-content">
                        <h3 id="equipamentosEstoque">0</h3>
                        <p>Em Estoque</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ü§ù</div>
                    <div class="stat-content">
                        <h3 id="equipamentosEmprestados">0</h3>
                        <p>Emprestados</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ÔøΩÔ∏è</div>
                    <div class="stat-content">
                        <h3 id="equipamentosManutencao">0</h3>
                        <p>Em Manuten√ß√£o</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <h3 id="taxaUtilizacao">0%</h3>
                        <p>Taxa de Utiliza√ß√£o</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <h3 id="valorTotal">R$ 0,00</h3>
                        <p>Valor Total do Invent√°rio</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíµ</div>
                    <div class="stat-content">
                        <h3 id="valorMedio">R$ 0,00</h3>
                        <p>Valor M√©dio por Equipamento</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîß</div>
                    <div class="stat-content">
                        <h3 id="custoManutencoes">R$ 0,00</h3>
                        <p>Custo Total de Manuten√ß√µes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚åõ</div>
                    <div class="stat-content">
                        <h3 id="manutencoesPendentes">0</h3>
                        <p>Manuten√ß√µes Pendentes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <h3 id="emprestimosRecentes">0</h3>
                        <p>Empr√©stimos (√öltimos 30 dias)</p>
                    </div>
                </div>
                <div class="stat-card clickable" id="statNotificacoes" onclick="mostrarNotificacoes()" title="Clique para ver detalhes">
                    <div class="stat-icon">üîî</div>
                    <div class="stat-content">
                        <h3 id="totalNotificacoes">0</h3>
                        <p>Devolu√ß√µes Pendentes</p>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Equipamentos por Status</h3>
                    <canvas id="statusChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Equipamentos por Tipo</h3>
                    <canvas id="tipoChart"></canvas>
                </div>
            </div>

            <div class="charts-grid charts-grid-spacing">
                <div class="chart-card">
                    <h3>Empr√©stimos Ativos por Departamento</h3>
                    <canvas id="departamentoChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top 5 Equipamentos Mais Emprestados</h3>
                    <canvas id="popularesChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Tabela de Equipamentos -->
        <section class="equipamentos-section">
            <h2>Lista de Equipamentos</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Buscar equipamentos...">
            </div>
            <div class="table-container">
                <table id="equipamentosTable">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tipo</th>
                            <th>Marca</th>
                            <th>Modelo</th>
                            <th>N¬∫ S√©rie</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="equipamentosBody">
                        <!-- Linhas ser√£o inseridas aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
        </div>

        <!-- Tab Empr√©stimos -->
        <div id="tabEmprestimos" class="tab-content">
            <section class="equipamentos-section emprestimos-section">
                <h2>Empr√©stimos Ativos</h2>
                <div class="search-box">
                    <input type="text" id="searchEmprestimoInput" placeholder="üîç Buscar empr√©stimos...">
                </div>
                <div class="table-container">
                    <table id="emprestimosTable">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Tipo</th>
                                <th>N¬∫ S√©rie</th>
                                <th>Respons√°vel</th>
                                <th>Departamento</th>
                                <th>Data Empr√©stimo</th>
                                <th>Devolu√ß√£o Prevista</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="emprestimosBody">
                            <!-- Linhas ser√£o inseridas aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal para Selecionar Categoria -->
    <div id="modalCategoria" class="modal">
        <div class="modal-content modal-categoria">
            <span class="close close-categoria">&times;</span>
            <h2>Selecione o Tipo de Equipamento</h2>
            <div class="categoria-grid">
                <div class="categoria-card" onclick="selecionarCategoria('computador')">
                    <div class="categoria-icon">üíª</div>
                    <h3>Computador</h3>
                    <p>Desktop, All-in-One, Workstation</p>
                </div>
                <div class="categoria-card" onclick="selecionarCategoria('notebook')">
                    <div class="categoria-icon">üíº</div>
                    <h3>Notebook</h3>
                    <p>Laptop, Ultrabook, Chromebook</p>
                </div>
                <div class="categoria-card" onclick="selecionarCategoria('periferico')">
                    <div class="categoria-icon">üñ®Ô∏è</div>
                    <h3>Perif√©rico</h3>
                    <p>Monitor, Impressora, Teclado, Mouse</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar/Editar Equipamento -->
    <div id="modalEquipamento" class="modal">
        <div class="modal-content">
            <span class="close close-equipamento">&times;</span>
            <h2 id="modalTitle">Adicionar Equipamento</h2>
            <form id="formEquipamento">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nome">Nome *</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="tipo">Tipo *</label>
                        <select id="tipo" name="tipo" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="marca">Marca *</label>
                        <input type="text" id="marca" name="marca" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modelo">Modelo *</label>
                        <input type="text" id="modelo" name="modelo" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="numero_serie">N√∫mero de S√©rie *</label>
                        <input type="text" id="numero_serie" name="numero_serie" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" name="status" required>
                            <option value="Estoque">Estoque</option>
                            <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                            <option value="Inativo">Inativo</option>
                        </select>
                    </div>
                    
                    <!-- Campos espec√≠ficos para Computador/Notebook -->
                    <div class="form-group campo-computador campo-notebook">
                        <label for="processador">Processador</label>
                        <input type="text" id="processador" name="processador" placeholder="Ex: Intel Core i5">
                    </div>
                    
                    <div class="form-group campo-computador campo-notebook">
                        <label for="memoria_ram">Mem√≥ria RAM *</label>
                        <input type="text" id="memoria_ram" name="memoria_ram" placeholder="Ex: 16GB">
                    </div>
                    
                    <div class="form-group campo-computador campo-notebook">
                        <label for="armazenamento">Armazenamento *</label>
                        <input type="text" id="armazenamento" name="armazenamento" placeholder="Ex: 512GB SSD">
                    </div>
                    
                    <div class="form-group campo-computador campo-notebook">
                        <label for="sistema_operacional">Sistema Operacional</label>
                        <input type="text" id="sistema_operacional" name="sistema_operacional" placeholder="Ex: Windows 11">
                    </div>
                    
                    <!-- Campos espec√≠ficos para Perif√©ricos -->
                    <div class="form-group campo-periferico">
                        <label for="conectividade">Conectividade</label>
                        <input type="text" id="conectividade" name="conectividade" placeholder="Ex: USB, Bluetooth, WiFi">
                    </div>
                    
                    <div class="form-group campo-periferico">
                        <label for="compatibilidade">Compatibilidade</label>
                        <input type="text" id="compatibilidade" name="compatibilidade" placeholder="Ex: Windows, Mac, Linux">
                    </div>
                    
                    <div class="form-group">
                        <label for="data_aquisicao">Data de Aquisi√ß√£o</label>
                        <input type="date" id="data_aquisicao" name="data_aquisicao">
                    </div>
                    
                    <div class="form-group">
                        <label for="valor">Valor (R$)</label>
                        <input type="number" id="valor" name="valor" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="foto">Foto do Equipamento</label>
                        <input type="file" id="foto" name="foto" accept="image/*">
                        <div class="foto-preview-container">
                            <img id="fotoPreview" src="" alt="Pr√©-visualiza√ß√£o da foto do equipamento" />
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="observacoes">Observa√ß√µes</label>
                        <textarea id="observacoes" name="observacoes" rows="3"></textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancelar">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Empr√©stimo -->
    <div id="modalEmprestimo" class="modal">
        <div class="modal-content">
            <span class="close close-emprestimo">&times;</span>
            <h2>Registrar Empr√©stimo</h2>
            <form id="formEmprestimo">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="equipamento_select">Equipamento *</label>
                        <input type="text" id="equipamento_search" placeholder="üîç Buscar equipamento por nome, tipo ou n√∫mero de s√©rie..." onkeyup="filtrarEquipamentosEstoque()">
                        <select id="equipamento_select" name="equipamento_id" required size="6" class="equipamento-select-spacing">
                            <!-- Op√ß√µes ser√£o inseridas via JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="responsavel">Respons√°vel *</label>
                        <input type="text" id="responsavel" name="responsavel" required placeholder="Nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="departamento">Departamento *</label>
                        <input type="text" id="departamento" name="departamento" required placeholder="Ex: TI, RH, Financeiro">
                    </div>
                    
                    <div class="form-group">
                        <label for="email_responsavel">E-mail</label>
                        <input type="email" id="email_responsavel" name="email_responsavel" placeholder="email@exemplo.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="telefone_responsavel">Telefone</label>
                        <input type="text" id="telefone_responsavel" name="telefone_responsavel" placeholder="(00) 00000-0000">
                    </div>
                    
                    <div class="form-group">
                        <label for="data_devolucao_prevista">Data de Devolu√ß√£o Prevista</label>
                        <input type="date" id="data_devolucao_prevista" name="data_devolucao_prevista">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="observacoes_emprestimo">Observa√ß√µes</label>
                        <textarea id="observacoes_emprestimo" name="observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o empr√©stimo..."></textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModalEmprestimo()">Cancelar</button>
                    <button type="submit" class="btn btn-success">Registrar Empr√©stimo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Manuten√ß√µes do Equipamento -->
    <div id="modalManutencao" class="modal">
        <div class="modal-content">
            <span class="close close-manutencao">&times;</span>
            <h2>üõ†Ô∏è Manuten√ß√µes do Equipamento</h2>
            <div class="manutencao-container">
                <div class="table-container table-spacing">
                    <table class="relatorios-table">
                        <thead>
                            <tr>
                                <th>Data In√≠cio</th>
                                <th>Data Fim</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>Respons√°vel</th>
                                <th>Fornecedor</th>
                                <th>Custo (R$)</th>
                                <th>Descri√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="manutencoesBody">
                            <tr><td colspan="9" class="loading-row">Carregando hist√≥rico...</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Adicionar Manuten√ß√£o</h3>
                <form id="formManutencao" class="perfil-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="manTipo">Tipo</label>
                            <select id="manTipo">
                                <option value="Corretiva">Corretiva</option>
                                <option value="Preventiva">Preventiva</option>
                                <option value="Atualiza√ß√£o">Atualiza√ß√£o</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="manStatus">Status</label>
                            <select id="manStatus">
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Conclu√≠da">Conclu√≠da</option>
                                <option value="Cancelada">Cancelada</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="manDataInicio">Data In√≠cio</label>
                            <input type="date" id="manDataInicio">
                        </div>
                        <div class="form-group">
                            <label for="manDataFim">Data Fim</label>
                            <input type="date" id="manDataFim">
                        </div>
                        <div class="form-group">
                            <label for="manCusto">Custo (R$)</label>
                            <input type="number" id="manCusto" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="manResponsavel">Respons√°vel</label>
                            <input type="text" id="manResponsavel">
                        </div>
                        <div class="form-group">
                            <label for="manFornecedor">Fornecedor</label>
                            <input type="text" id="manFornecedor">
                        </div>
                        <div class="form-group full-width">
                            <label for="manDescricao">Descri√ß√£o</label>
                            <textarea id="manDescricao" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="btnCancelarManutencao">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal QR Code -->
    <div id="modalQRCode" class="modal">
        <div class="modal-content modal-qrcode">
            <span class="close" onclick="fecharModalQRCode()">&times;</span>
            <h2>QR Code do Equipamento</h2>
            
            <div id="qrcodeContainer">
                <div id="qrcodeInfo"></div>
                <img id="qrcodeImage" alt="QR Code do equipamento" />
                <div class="qrcode-actions">
                    <button onclick="baixarQRCode()" class="btn btn-primary">
                        üì• Baixar QR Code
                    </button>
                    <button onclick="imprimirQRCode()" class="btn btn-secondary">
                        üñ®Ô∏è Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pwa.js') }}"></script>
</body>
</html>
